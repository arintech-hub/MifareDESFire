# DFCrypto
Provides methods for performing Mifare DESFire cryptograhic operations

The class has the following methods and enummeration:

|METHODS                                       |DESCRIPTION                                                                                        |
|:---------------------------------------------|:--------------------------------------------------------------------------------------------------|
|public static byte[] getRndA(CipAlg alg)|Generates the random frame RndA for the authentication operation of the suitable length according to the cryptographic algorithm in use @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return a randomized byte array|
|public static byte[] getRndB(byte[] ekRndB, byte[] keyData, CipAlg alg)|Retrieves the RndB frame from the received enciphered array in the authentication operation @param ekRndB a byte array representing the received enciphered array containing the randomized RndB frame @param keyData a byte array representing the key by which the received frame has been enciphered @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return the original deciphered RndB frame|
|public static byte[] getDKRndARndBp(byte[] RndA, byte[] RndB, yte[] keyData, CipAlg alg)|Generates the frame to send to the card for the authentication operation including both the created RndA and the retrieved RndB @param RndA a byte array containing the created randomized RndA @param RndB a byte array containing the retrieved RndB @param keyData a byte array representing the key by which the received frame has been enciphered @param alg an instance o class <code>CipAlg</code> representing the current cryptographic algorithm @return a deciphered byte array generated using both RndA and RndB|
|public static byte[] getEKRndARndBp(byte[] RndA, byte[] RndB, byte[] keyData, byte[] iv, CipAlg alg)|Generates the frame to send to the card for the authentication operation including both the created RndA and the retrieved RndB @param RndA a byte array containing the created randomized RndA @param RndB a byte array containing the retrieved RndB @param keyData a byte array representing the key by which the received frame has been enciphered @param iv a byte array representing the initial vector for the cryptographic operations @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return an enciphered byte array generated using both RndA and RndB|
|public static boolean getPICCAuth(byte[] RndA, byte[] ekRndAp, byte[] keyData, CipAlg alg)|Checks if the card has successfully retrieved the previously sent RndA frame @param RndA a byte array containing the created randomized RndA @param ekRndAp a byte array containing the retrieved RndAp @param keyData a byte array representing the key by which the received frame has been enciphered @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return <code>true</code> true if the PICC has been successfully authenticated; <code>false</code> otherwise|
|public static boolean getPICCAuth(byte[] RndA, byte[] ekRndAp, byte[] keyData, byte[] iv, CipAlg alg)|Checks if the card has successfully retrieved the previously sent RndA frame @param RndA a byte array containing the created randomized RndA @param ekRndAp a byte array containing the retrieved RndAp @param keyData a byte array representing the key by which the received frame has been enciphered @param iv a byte array representing the initial vector for the cryptographic operations @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return <code>true</code> true if the PICC has been successfully authenticated;<code>false</code> otherwise|
|public static byte[] getSessionKey(byte[] RndA, byte[] RndB, CipAlg alg)|Generates the current session key @param RndA a byte array containing the created randomized RndA @param RndB a byte array containing the retrieved RndB @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return a byte array representing the current session key|
|public static byte[] getKeyNumBA(int keyNum, CipAlg alg)|Generates the byte array representation of a key number, in the suitable format according to the cryptographic algorithm in use @param keyNum an int indicating the key number @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return a byte array representing the key number given by <code>keyNum</code>|
|public static byte[] getData(byte[] res, DFSession session)|Extracts the field bytes from a response frame @param res a byte array received from a card, without the status code @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array containing the received data frame|
|public static byte[] getKeySettings2(int numOfKeys, boolean ISOFidAllow, CipAlg alg)|Generates the byte array corresponding to the Key Settings 2 structure @param numOfKeys an int representing the number of keys @param ISOFidAllow a boolean indicating whether ISO file identifiers are allowed @param alg an instance of class <code>CipAlg</code> representing the current cryptographic algorithm @return a byte array representing the Key Settings 2 structure|
|public static byte[] getEncOptData(ConfigOption opt, DFSession session)|Generates the byte array needed for the <code>setConfiguration</code> command @param opt an instance of class <code>ConfigOption</code> representing the configuration options @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array representing the <code>setConfiguration</code> send parameter|
|public static byte[] prepareSendData(FID fid, Size offset, Data data, ComSet comSet, AccessRights ar, ComCode com, DFSession session)|Generates the byte array to send data @param fid an instance of class <code>FID</code> representing the file identifier @param offset an instance of class <code>Size</code> representing the starting point of the data bytes in the frame @param data an instance of class <code>Data</code> containing the data bytes to send @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param com an instance of class <code>ComCode</code> representing the command code @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array with the data to be sent suitably formatted|
|public static ComSet getSendDataEffComSet(ComSet comSet, AccessRights ar, DFSession session)|Obtains the communication settings that will effectively be used when sending data @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>ComSet</code> representing the effective communication settings|
|public static DataRes getDataRes(byte[] res, Size length, ComSet comSet, AccessRights ar, DFSession session)|Extracts the effective data bytes from a response frame @param res a byte array received from a card, without the status code @param length an instance of class <code>Size</code> representing the number of bytes that have been read from the card @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array corresponding to the effective read data response structure|
|private static DataRes getDataRes(byte[] res, Size length, ComSet effComSet, DFSession session)|Extracts the effective data bytes from a response frame @param res a byte array received from a card, without the status code @param length an instance of class <code>Size</code> representing the number of bytes that have been read from the card @param effComSet an instance of class <code>ComSet</code> representing the effective communication settings @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>DataRes</code> corresponding to the effective read data response structure|
|public static ComSet getDataEffComSet(ComSet comSet, AccessRights ar, DFSession session)|Obtains the communication settings that will effectively be used when reading data @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>ComSet</code> representing the effective communication settings|
|private static byte[] extractDataCRC(byte[] plainRes)|Extracts the bytes corresponding to the Cyclic Redundancy Code from a received frame @param plainRes a byte array received from a card, without the status code @return a byte array corresponding to the CRC extracted from <code>plainRes</code>|
|public static ValueRes getValueRes(byte[] res, ComSet comSet, AccessRights ar, boolean getFreeValue, DFSession session)|Extracts the effective value bytes from a response frame @param res a byte array received from a card, without the status code @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param getFreeValue a boolean indicating whether get value operations are allowed without previous authentication @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array corresponding to the effective get value response structure|
|private static ValueRes getValueRes(byte[] res, ComSet effComSet, DFSession session)|Extracts the effective value bytes from a response frame @param res a byte array received from a card, without the status code @param effComSet an instance of class <code>ComSet</code> representing the effective communication settings @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>ValueRes</code> corresponding to the effective get value response structure|
|public static ComSet getGetValueEffComSet(ComSet comSet, AccessRights ar, boolean getFreeValue, DFSession session)|Obtains the communication settings that will effectively be used when reading a value @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param getFreeValue @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>ComSet</code> representing the effective communication settings|
|public static byte[] prepareSendValueData(FID fid, Value value, ComSet comSet, AccessRights ar, ComCode com, DFSession session)|Generates the byte array to send a value @param value an instance of class <code>Value</code> representing the amount to send @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param com an instance of class <code>ComCode</code> representing the command code @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array with the data to be sent suitably formatted|
|public static ComSet getSendValueEffComSet(ComSet comSet, AccessRights ar, ComCode com, DFSession session)|Obtains the communication settings that will effectively be used when sending a value @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param com an instance of class <code>ComCode</code> representing the command code @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>ComSet</code> representing the effective communication settings|
|public static RecordsRes getRecordsRes(byte[] res, Size length, Size recSize, ComSet comSet, AccessRights ar, DFSession session)|Extracts the effective record bytes from a response frame @param res a byte array received from a card, without the status code @param length an instance of class <code>Size</code> representing the number of records that have been read from the card @param recSize an instance of class <code>Size</code> representing the length of each record @param comSet an instance of class <code>ComSet</code> representing the current communication settings @param ar an instance of class <code>AccessRights</code> representing the current access rights @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>RecordsRes</code> corresponding to the effective read records response structure|
|public static byte[] padding(byte[] data, AuthType auth)|Performs the padding to a byte array according to the proper authentication type @param data a byte array containing data @param auth an instance of class <code>AuthType</code> representing the current authentication type @return a padded byte array|
|public static byte[] padding(byte[] data, AuthType auth, PaddingMode pad)|Performs the padding to a byte array according to the proper authentication type @param data a byte array containing data @param auth an instance of class <code>AuthType</code> representing the current authentication type @param pad an instance of class <code>PaddingMode</code> indicating the mode by which the padding should be performed @return a padded byte array|
|public static byte[] CRC(ComCode com, byte[] plainParam, byte[] data, AuthType auth)|Computes the Cyclic Redundancy Code @param com an instance of class <code>ComCode</code> representing the command code @param plainParam a byte array containing the send parameters in plain @param data a byte array containing the data to be sent @param auth an instance of class <code>AuthType</code> representing the current authentication type @return a byte array corresponding to the computed CRC|
|public static byte[] CRC(ComCode com, byte[] data, AuthType auth)|Computes the Cyclic Redundancy Code @param com an instance of class <code>ComCode</code> representing the command code @param data a byte array containing the data to be sent @param auth an instance of class <code>AuthType</code> representing the current authentication type @return a byte array corresponding to the computed CRC|
|public static byte[] CRC(byte[] data, AuthType auth) & private static byte[] CRC(byte[] data, SC sc, AuthType auth)|Computes the Cyclic Redundancy Code @param data a byte array containing the data to be sent @param auth an instance of class <code>AuthType</code> representing the current authentication type @return a byte array corresponding to the computed CRC|
|public static boolean checkCRC(byte[] res, SC sc, DFSession session, byte[] crcPad) & private static int getCRCLength(DFSession session)|Checks the received Cyclic Redudancy Code @param res a byte array received from a card, without the status code @param sc an instance of class <code>SC</code> representing the received status code from the card @param session an instance of class <code>DFSession</code> representing the current communication session @param crcPad a byte array containing both the received CRC and the padding from the response @return <code>true</code> if the CRC check is successful; <code>false</code> otherwise|
|public static void updateCmacIV(ComCode com, DFSession session)|Updates the current value of the CMAC computation initial vector @param com an instance of class <code>ComCode</code> representing the command code @param session an instance of class <code>DFSession</code> representing the current communication session|
|public static void updateCmacIV(ComCode com, byte[] data, DFSession session) & private static void updateCmacIV(byte[] data, DFSession session)|Updates the current value of the CMAC computation initial vector @param com an instance of class <code>ComCode</code> representing the command code @param data a byte array containing the data to be sent @param session an instance of class <code>DFSession</code> representing the current communication session|
|public static void checkCMAC(byte[] res, DFSession session) & private static boolean checkMAC(byte[] res, DFSession session) & public static int getMacLength(DFSession session)|Checks the received Cipher-based Message  Authentication Code @param res a byte array received from a card, without the status code @param session an instance of class <code>DFSession</code> representing the current communication session|
|public static int getKeyVersion(byte[] keyData)|Extracts the key version of a key @param keyData a byte array containing a key @return an int representing the key version extracted from <code>keyBytes</code>|
|public static byte[] encode(byte[] data, DFSession session) & private static byte[] encode(byte[] data, DFSession session, PaddingMode pad)|Performs an encoding operation @param data a byte array containing the data to be sent or that has been received @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array corresponding to the encoded data|
|public static byte[] decode(byte[] data, DFSession session)|Performs a decoding operation @param data a byte array containing the data to be sent or that has been received @param session an instance of class <code>DFSession</code> representing the current communication session @return a byte array corresponding to the decoded data|
|public static CipAlg getAlg(DFSession session)|Obtains the currently used cryptographic algorithm @param session an instance of class <code>DFSession</code> representing the current communication session @return an instance of class <code>CipAlg</code> representing the currently used cryptographic algorithm|
|public static CipAlg getAlg(byte[] algBA)|Obtains the <code>CipAlg</code> representation of a given cryptographic algorithm @param algBA an byte array representing the current cryptographic algorithm @return an instance of class <code>CipAlg</code> corresponding to the cryptographic algorithm represented by <code>algBA</code>|
|public static CipAlg getDESAlg(byte[] keyData)|Deduces the specific DES or TDES algorithm to use according to the bytes stored in the given key @param keyData a byte array containing a key @return an instance of class <code>CipAlg</code> representing the specific DES or TDES algorithm to use|
